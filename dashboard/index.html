<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital IoT Monitoring System</title>
    <meta name="description" content="Real-time hospital bed occupancy and patient vital monitoring dashboard">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body data-theme="dark">

    <!-- ======== LOGIN PAGE ======== -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="login-glow"></div>
            <div class="login-card glass-card">
                <div class="login-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--accent)"
                        stroke-width="1.5">
                        <path d="M12 2L2 7l10 5 10-5-10-5z" />
                        <path d="M2 17l10 5 10-5" />
                        <path d="M2 12l10 5 10-5" />
                    </svg>
                </div>
                <h1>Hospital IoT</h1>
                <p class="login-subtitle">Patient Vital Monitoring System</p>
                <form id="login-form">
                    <div class="input-group">
                        <input type="text" id="login-username" placeholder="Username" required autocomplete="username">
                    </div>
                    <div class="input-group">
                        <input type="password" id="login-password" placeholder="Password" required
                            autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn-primary btn-glow">Sign In</button>
                    <p id="login-error" class="error-text"></p>
                </form>
            </div>
        </div>
    </div>

    <!-- ======== MAIN APP ======== -->
    <div id="app" class="app-layout hidden">

        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar glass-card">
            <div class="sidebar-header">
                <div class="logo-pulse">
                    <span class="pulse-dot"></span>
                </div>
                <h2>Hospital IoT</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="#overview" class="nav-link active" data-page="overview">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                    </svg>
                    <span>Overview</span>
                </a>
                <a href="#devices" class="nav-link" data-page="devices">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="3" width="20" height="14" rx="2" />
                        <line x1="8" y1="21" x2="16" y2="21" />
                        <line x1="12" y1="17" x2="12" y2="21" />
                    </svg>
                    <span>Devices</span>
                </a>
                <a href="#device-detail" class="nav-link" data-page="device-detail" id="nav-device-detail"
                    style="display:none;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                    </svg>
                    <span>Device Detail</span>
                </a>
                <a href="#alerts" class="nav-link" data-page="alerts">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                        <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                    </svg>
                    <span>Alerts</span>
                    <span id="alert-badge" class="badge hidden">0</span>
                </a>
                <a href="#analytics" class="nav-link" data-page="analytics">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                    </svg>
                    <span>AI Analytics</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="theme-switcher">
                    <button class="theme-btn active" data-theme="dark" title="Dark">üåô</button>
                    <button class="theme-btn" data-theme="medical" title="Medical Blue">üíô</button>
                    <button class="theme-btn" data-theme="emergency" title="Emergency">üî¥</button>
                </div>
                <button id="logout-btn" class="btn-logout">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                    <span id="username-display">Admin</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Toast Container -->
            <div id="toast-container"></div>

            <!-- ======= OVERVIEW PAGE ======= -->
            <section id="page-overview" class="page-content active">
                <div class="page-header">
                    <h1>Hospital Overview</h1>
                    <div class="header-actions">
                        <span class="live-indicator"><span class="live-dot"></span> LIVE</span>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card glass-card">
                        <div class="stat-icon" style="--accent-color: var(--accent)">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="2" y="3" width="20" height="14" rx="2" />
                                <line x1="8" y1="21" x2="16" y2="21" />
                                <line x1="12" y1="17" x2="12" y2="21" />
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-total">0</span>
                            <span class="stat-label">Total Devices</span>
                        </div>
                    </div>
                    <div class="stat-card glass-card">
                        <div class="stat-icon" style="--accent-color: #00e676">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <path d="M8 14s1.5 2 4 2 4-2 4-2" />
                                <line x1="9" y1="9" x2="9.01" y2="9" />
                                <line x1="15" y1="9" x2="15.01" y2="9" />
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-online">0</span>
                            <span class="stat-label">Online</span>
                        </div>
                    </div>
                    <div class="stat-card glass-card">
                        <div class="stat-icon" style="--accent-color: #ff9100">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z" />
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-occupancy">0%</span>
                            <span class="stat-label">Bed Occupancy</span>
                        </div>
                    </div>
                    <div class="stat-card glass-card">
                        <div class="stat-icon" style="--accent-color: #ff1744">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                                <line x1="12" y1="9" x2="12" y2="13" />
                                <line x1="12" y1="17" x2="12.01" y2="17" />
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-alerts">0</span>
                            <span class="stat-label">Active Alerts</span>
                        </div>
                    </div>
                </div>

                <!-- Floor Plan -->
                <div class="hospital-3d-container glass-card">
                    <div class="section-header">
                        <h2>Hospital Floor Plan</h2>
                        <span class="subtitle">Hover on a bed to see patient details</span>
                    </div>
                    <div id="floor-plan-container"></div>
                </div>

                <!-- Device Grid -->
                <div class="section-header">
                    <h2>Device Status Grid</h2>
                </div>
                <div id="device-grid" class="device-grid"></div>
            </section>

            <!-- ======= DEVICES PAGE ======= -->
            <section id="page-devices" class="page-content">
                <div class="page-header">
                    <h1>Device Management</h1>
                    <button id="add-device-btn" class="btn-primary btn-glow">+ Add Device</button>
                </div>

                <!-- Add Device Modal -->
                <div id="add-device-modal" class="modal hidden">
                    <div class="modal-overlay"></div>
                    <div class="modal-card glass-card">
                        <h2>Register New Device</h2>
                        <form id="add-device-form">
                            <div class="input-group">
                                <label>Ward / Block (auto-assigned if empty)</label>
                                <input type="text" id="device-ward" placeholder="e.g., Block A (leave empty for auto)">
                            </div>
                            <div class="input-group">
                                <label>Bed Number (auto-assigned if empty)</label>
                                <input type="text" id="device-bed" placeholder="e.g., 01, 02 (leave empty for auto)">
                            </div>
                            <div class="input-group">
                                <label>Patient Name (Optional)</label>
                                <input type="text" id="device-patient" placeholder="Patient name">
                            </div>
                            <div class="modal-actions">
                                <button type="button" class="btn-secondary" id="cancel-device-btn">Cancel</button>
                                <button type="submit" class="btn-primary">Register</button>
                            </div>
                        </form>
                        <!-- API Key Display -->
                        <div id="api-key-result" class="hidden">
                            <div class="api-key-box">
                                <p>Device registered! Save this API key:</p>
                                <div class="api-key-display">
                                    <code id="new-api-key"></code>
                                    <button id="copy-key-btn" class="btn-icon" title="Copy">üìã</button>
                                </div>
                                <p class="warning-text">‚ö†Ô∏è This key is shown only once. Flash it to the ESP8266.</p>
                                <p><strong>Device ID:</strong> <code id="new-device-id"></code></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Device Table -->
                <div class="table-container glass-card">
                    <table id="device-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Device ID</th>
                                <th>Ward</th>
                                <th>Bed</th>
                                <th>Patient</th>
                                <th>Last Seen</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="device-table-body">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ======= DEVICE DETAIL PAGE ======= -->
            <section id="page-device-detail" class="page-content">
                <div class="page-header">
                    <button class="btn-back" onclick="navigateTo('devices')">‚Üê Back</button>
                    <h1 id="detail-device-title">Device Detail</h1>
                    <div class="header-actions">
                        <span id="detail-status-badge" class="status-badge">offline</span>
                    </div>
                </div>

                <!-- Patient Info -->
                <div class="detail-info glass-card">
                    <div class="info-item">
                        <span class="info-label">Device ID</span>
                        <span class="info-value" id="detail-device-id">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Ward</span>
                        <span class="info-value" id="detail-ward">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Bed</span>
                        <span class="info-value" id="detail-bed">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Patient</span>
                        <span class="info-value" id="detail-patient">‚Äî</span>
                    </div>
                </div>

                <!-- Live Vitals -->
                <div class="vitals-grid">
                    <div class="vital-card glass-card">
                        <div class="vital-header">
                            <h3>Heart Rate</h3>
                            <span class="vital-unit">BPM</span>
                        </div>
                        <div class="vital-value-large" id="detail-hr">--</div>
                        <canvas id="heartbeat-canvas" class="heartbeat-canvas"></canvas>
                    </div>
                    <div class="vital-card glass-card">
                        <div class="vital-header">
                            <h3>SpO‚ÇÇ</h3>
                            <span class="vital-unit">%</span>
                        </div>
                        <div class="vital-value-large" id="detail-spo2">--</div>
                        <div class="spo2-gauge-container">
                            <svg class="spo2-gauge" viewBox="0 0 120 120">
                                <circle class="gauge-bg" cx="60" cy="60" r="52" />
                                <circle class="gauge-fill" id="spo2-gauge-fill" cx="60" cy="60" r="52" />
                            </svg>
                        </div>
                    </div>
                    <div class="vital-card glass-card">
                        <div class="vital-header">
                            <h3>Bed Status</h3>
                        </div>
                        <div class="vital-value-large" id="detail-bed-status">--</div>
                        <div id="bed-status-indicator" class="bed-indicator"></div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card glass-card">
                        <h3>Heart Rate History</h3>
                        <canvas id="hr-chart"></canvas>
                    </div>
                    <div class="chart-card glass-card">
                        <h3>SpO‚ÇÇ History</h3>
                        <canvas id="spo2-chart"></canvas>
                    </div>
                </div>

                <!-- Alert History -->
                <div class="glass-card" style="padding: 1.5rem;">
                    <h3>Alert History</h3>
                    <div id="detail-alerts" class="alert-list"></div>
                </div>
            </section>

            <!-- ======= ALERTS PAGE ======= -->
            <section id="page-alerts" class="page-content">
                <div class="page-header">
                    <h1>Alerts</h1>
                    <div class="header-actions">
                        <select id="alert-filter" class="input-select">
                            <option value="">All Severities</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
                <div id="alerts-list" class="alerts-container"></div>
            </section>

            <!-- ======= AI ANALYTICS PAGE ======= -->
            <section id="page-analytics" class="page-content">
                <div class="page-header">
                    <h1>AI Analytics</h1>
                </div>
                <div class="analytics-grid">
                    <div class="glass-card analytics-card">
                        <h3>Risk Distribution</h3>
                        <canvas id="risk-chart"></canvas>
                    </div>
                    <div class="glass-card analytics-card">
                        <h3>Anomaly Trends (24h)</h3>
                        <canvas id="anomaly-chart"></canvas>
                    </div>
                    <div class="glass-card analytics-card wide">
                        <h3>Alert Timeline</h3>
                        <canvas id="timeline-chart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script src="three_scene.js"></script>
    <script src="dashboard.js"></script>
</body>

</html>